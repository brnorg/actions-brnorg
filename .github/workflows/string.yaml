name: tranformacao de string

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'nome'
        required: false
        type: choice
        options:
          - dr
          - prod
          - cer
          - "[dr, prod]"
  
jobs:
  change-string:
    runs-on: ubuntu-latest

    steps:
     - name: teste
       run: |
        ambiente="a1,a2"
        
        # Transforma a string em um array, separando os valores pela vírgula
        IFS=',' read -r -a valores <<< "$ambiente"
        
        # Inicia a construção do JSON
        json="{"
        
        # Loop pelos valores no array
        for valor in "${valores[@]}"; do
            # Adiciona cada par chave-valor ao JSON
            json="$json\n  \"$valor\": \"$valor\","
        done
        
        # Remove a última vírgula e fecha o JSON
        json="${json%,*}\n}"
        
        # Imprime o JSON
        echo "matrix=$json" >> $GITHUB_OUTPUT


  job2:
   needs: change-string
   runs-on: ubuntu-latest
   strategy:
      matrix: ${{ fromJSON(needs.change-string.outputs.matrix) }}
   steps:
     - run: echo "Matrix - Project ${{ matrix.project }}, Config ${{ matrix.config }}"              
